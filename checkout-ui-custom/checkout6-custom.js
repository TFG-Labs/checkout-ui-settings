(()=>{"use strict";const e={buildingType:["Free standing","House in complex","Townhouse","Apartment"],parkingDistance:[15,25,50,100],deliveryFloor:["Ground","1","2","3+"],liftOrStairs:["Lift","Stairs"]},t=()=>'<span class="help error">This field is required.</span>',s=()=>'\n  <p id="box-pickup-complement" class="input custom-field-complement tfg-custom-addressForm">\n    <label>Mobile number</label>\n    <input id="custom-pickup-complement" class="input-xlarge success" type="text" field="complement" placeholder="" />\n  </p>',a="#/shipping",n="#/payment",i=750,r="ricafields",o="tvfields",d="furniturefields",l=window.location.host.includes("bash.com")?"https://store-api.www.bash.com/custom-api/":`${window.location.protocol}//${window.location.host}/custom-api/`,c='\n<a \n  href="http://image.tfgmedia.co.za/image/1/process/500x790?source=http://cdn.tfgmedia.co.za/15/Marketing/HTMLPages/Furniture_Delivery_Fees_tab_image.jpg"\n  class="furniture-fees-link" \n  target="_blank"\n>\n  Furniture delivery costs\n</a>\n',p="1169288799",u=()=>window.vtexjs.checkout.orderForm?.shippingData?.address?.complement||window.vtexjs.checkout.orderForm?.clientProfileData?.phone||document?.getElementById("client-phone")?.value,m=e=>{throw console.error("ERROR",e),new Error(e)},h=({cookie:e,cache:t,json:s})=>{const a=new Headers;return e&&a.append("Cookie",document?.cookie),t&&a.append("Cache-Control","no-cache"),s&&a.append("Content-type","application/json"),a},v=async(e,t)=>{let s={};const a={headers:h({cookie:!0,cache:!0,json:!1}),credentials:"include"},n=await fetch(`${l}masterdata/addresses/${t}&_where=addressName=${e}&timestamp=${Date.now()}`,a).then((e=>e.json())).catch((e=>m(`GET_ADDRESS_ERROR: ${e?.message}`)));return n&&!n.error&&n.data&&n.data.length>0&&([s]=n.data),s},g=async(e,t,s=1)=>{if(e||t){const{address:a}=window.vtexjs.checkout.orderForm.shippingData,n="?_fields=buildingType,parkingDistance,deliveryFloor,liftOrStairs,hasSufficientSpace,assembleFurniture,tvID",i=await v(a.addressId,n);i&&!jQuery.isEmptyObject(i)?(e&&($("#tfg-building-type").val(i.buildingType),$("#tfg-parking-distance").val(i.parkingDistance),$("#tfg-delivery-floor").val(i.deliveryFloor),"Ground"===$("#tfg-delivery-floor").val()?$("#tfg-lift-stairs").attr("disabled","disabled"):$("#tfg-lift-stairs").val(i.liftOrStairs),$("#tfg-sufficient-space").prop("checked",i.hasSufficientSpace),$("#tfg-assemble-furniture").prop("checked",i.assembleFurniture)),t&&$("#tfg-tv-licence").val(i.tvID)):s<=5&&setTimeout((()=>{g(e,t,s+=1)}),3e3)}},b=e=>{const{customData:t}=window.vtexjs.checkout.orderForm;let s={};return t&&t.customApps&&t.customApps.length>0&&t.customApps.forEach((t=>{t.id===e&&(s=t.fields)})),s},f=(e,t)=>{const{orderFormId:s}=window.vtexjs.checkout.orderForm;return $.ajax({type:"PUT",url:`/api/checkout/pub/orderForm/${s}/customData/${e}`,dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify(t)})},y=(e="customApps")=>{let t;if("shippingAddress"===e){const{address:e}=window.vtexjs.checkout.orderForm.shippingData;t={idOrPassport:"",sameAddress:"true",fullName:e.receiverName||$("#ship-receiverName").val(),streetAddress:`${e.street}, ${e.number}`,suburb:e.neighborhood,city:e.city,postalCode:e.postalCode,province:e.state}}else"customApps"===e&&(t=b(r));t&&!jQuery.isEmptyObject(t)&&("customApps"===e&&($("#tfg-rica-id-passport").val(t.idOrPassport),$("#tfg-rica-same-address").prop("checked","true"===t.sameAddress)),$("#tfg-rica-fullname").val(t.fullName),$("#tfg-rica-street").val(t.streetAddress),$("#tfg-rica-suburb").val(t.suburb),$("#tfg-rica-city").val(t.city),$("#tfg-rica-postal-code").val(t.postalCode),$("#tfg-rica-province").val(t.province))},w=e=>(e=>!!e&&("0"===(e=e.replace(/\s/g,""))[0]?e.match(/[0-9\s]{10}/):e.match(/[0-9\s]{9,}/)))(e),x=e=>{const t=[p],s=["938942995"],a=["24833302"],n=[];let i=!1,r=!1,o=!1;return e.forEach((e=>{const d=e.productCategoryIds.split("/");n.push(d),d.forEach((e=>{e&&(s.includes(e)&&(i=!0),a.includes(e)&&(r=!0),t.includes(e)&&(o=!0))}))})),{hasFurniture:o,hasSimCards:r,hasTVs:i,categories:n}},k=()=>{$(".shimmer").removeClass("shimmer")},F=(()=>{const e={inCollect:!1,pickupSelected:!1,validForm:!1,runningObserver:!1},t=()=>{if($("span.help.error").remove(),e.validForm=!0,["pickup-receiver","custom-pickup-complement"].forEach((t=>{let s,a=!0;switch(t){case"pickup-receiver":a=!($(`#${t}`).length>0&&!$(`#${t}`).attr("disabled")&&!$(`#${t}`).val()),s=".shp-pickup-receiver";break;case"custom-pickup-complement":a=w($(`#${t}`).val()),s="#box-pickup-complement"}a?$(s).removeClass("error"):($(s).addClass("error"),$(s).append('<span class="help error">This field is required.</span>'),$(`${s} span.error`).show(),e.validForm=!1)})),e.validForm){let e=$("#custom-pickup-complement").val().replace(/\s/g,"");9===e.length&&"0"!==e[0]&&(e=`0${e}`),localStorage.setItem("saving-shipping-collect",!0),$("#btn-go-to-payment").trigger("click"),setTimeout((()=>{window.vtexjs.checkout.getOrderForm().then((t=>{const{address:s}=t.shippingData;return s.complement=e,window.vtexjs.checkout.calculateShipping(s)})).done((()=>{localStorage.removeItem("saving-shipping-collect")}))}),i)}},r=()=>{const i=$("div#postalCode-finished-loading").length>0;window.location.hash===a&&i?(e.inCollect=$("#shipping-option-pickup-in-point").hasClass("shp-method-option-active"),e.pickupSelected=0===$("div.ask-for-geolocation").length,e.inCollect&&(e.pickupSelected?($("button.shp-pickup-receiver__btn").trigger("click"),$("div.shp-pickup-receiver").addClass("show"),(()=>{const e=window.vtexjs.checkout.orderForm?.clientProfileData?.phone??$("#client-phone").val()??"";0===$("input#custom-pickup-complement").length?($(".btn-go-to-payment-wrapper").before(s),(()=>{const e=document.querySelector("input#custom-pickup-complement");e&&e.setAttribute("placeholder","")})(),e&&$("input#custom-pickup-complement").val(e)):""===$("input#custom-pickup-complement").val()&&($("input#custom-pickup-complement").val(e),window.vtexjs.checkout.getOrderForm().then((t=>{const{shippingData:s}=t;return s.address.complement=e,window.vtexjs.checkout.sendAttachment("shippingData",s)}))),(()=>{const{firstName:e,lastName:t}=window.vtexjs.checkout.orderForm?.clientProfileData,s=$("#client-first-name").val(),a=$("#client-last-name").val(),n=e?[e,t].join(" "):[s,a].join(" ");""===$("input#pickup-receiver").val()&&($("input#pickup-receiver").val(n.trim()),window.vtexjs.checkout.getOrderForm().then((e=>{const{shippingData:t}=e;return t.address.receiverName=n.trim(),window.vtexjs.checkout.sendAttachment("shippingData",t)})))})()})(),(()=>{if($("#custom-go-to-payment").length<=0){const e=$("#btn-go-to-payment"),s=e.clone(!1);$(e).hide(),$(s).data("bind",""),$(s).removeAttr("id").attr("id","custom-go-to-payment"),$(s).removeAttr("data-bind"),$(s).css("display","block"),$("p.btn-go-to-payment-wrapper").append(s),$(s).on("click",t)}})()):$("div.shp-pickup-receiver").removeClass("show"),$("p.vtex-omnishipping-1-x-shippingSectionTitle").text("Collect options"),$("#change-pickup-button").text("Available pickup points"),$("h2.vtex-omnishipping-1-x-geolocationTitle.ask-for-geolocation-title").text("Find nearby Click & Collect points"),$("h3.vtex-omnishipping-1-x-subtitle.ask-for-geolocation-subtitle").text("Search for addresses that you frequently use and we'll locate stores nearby."),e.pickupSelected&&$("label.shp-pickup-receiver__label").text("Recipient's name")),localStorage.getItem("shipping-incomplete-values")&&($("#custom-go-to-payment").trigger("click"),localStorage.removeItem("shipping-incomplete-values"))):($("#box-pickup-complement").remove(),window.location.hash===n&&setTimeout((()=>{const e=window.vtexjs.checkout.orderForm?.shippingData?.address;localStorage.getItem("saving-shipping-collect")||!e||"search"!==e.addressType||e.receiverName&&e.complement||(window.location.hash=a,localStorage.setItem("shipping-incomplete-values",!0))}),1e3)),o()},o=()=>{if(e.runningObserver)return;const t=document.querySelector(".shipping-container .box-step"),s=new MutationObserver((()=>{e.runningObserver=!0,r()}));t&&s.observe(t,{attributes:!1,childList:!0,characterData:!1})};return $(document).ready((()=>{r()})),$(window).on("hashchange orderFormUpdated.vtex",(()=>{r()})),{state:e,init:()=>{}}})(),C=({name:e,options:t=[]})=>`\n  \n  <div class="bash--radio-options">\n  ${t.map((({value:t,label:s,checked:a=!1,disabled:n=!1})=>`\n      <label class="bash--radio-option" id="radio-label-${e}-${t}">\n        <input type="radio" \n          ${a?"checked='checked'":""} \n          ${n?"disabled='disabled'":""} \n          value="${t??""}" \n          name="${e}" \n          id="radio-${e}-${t}"\n        />\n          <span class="radio-icon"></span> \n          ${s?`<span class="radio-label">${s}</span>`:""}\n      </label>\n    `)).join("")}\n   \n  </div>\n  `,D=(e,t)=>JSON.stringify({street:e.street,neighborhood:e.neighborhood,city:e.city,postalCode:e.postalCode})===JSON.stringify({street:t.street,neighborhood:t.neighborhood,city:t.city,postalCode:t.postalCode}),S=e=>{const{number:t,street:s,neighborhood:a,postalCode:n,city:i,receiverName:r,complement:o,addressName:d}=e,l=[`${t??""} ${s}`,a??i,n].join(", "),c=[r,o].join(" - "),{address:p}=window?.vtexjs?.checkout?.orderForm?.shippingData;return`\n<label id="address-${d}" class="bash--address-listing" data-address="${encodeURIComponent(JSON.stringify(e))}">\n  <div class="address-radio">\n  ${C({name:"selected-address",options:[{checked:D(e,p),value:d}]})}\n  </div>\n  <div class="address-text">\n    <div>${l}</div>    \n    <div>${c}</div>  \n  </div>\n  <div class="address-edit">\n    <a href="#" data-view="address-edit" data-content="address-${d}">\n      Edit\n    </a>\n  </div>\n</label>\n`},I=e=>{throw console.error("ERROR",e),new Error(e)},A=({cookie:e,cache:t,json:s})=>{const a=new Headers;return e&&a.append("Cookie",document?.cookie),t&&a.append("Cache-Control","no-cache"),s&&a.append("Content-type","application/json"),a},T=new class{constructor(){this.indexedDB=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.msIndexedDB||window.shimIndexedDB,this.checkoutDB=indexedDB.open("checkoutDB",1.2),this.checkoutDB.onerror=e=>{throw console.error("CheckoutDB Error",{event:e}),new Error("Could not load checkoutDB")},this.checkoutDB.onupgradeneeded=()=>{const e=this.checkoutDB.result.createObjectStore("addresses",{keyPath:"addressName"});e.createIndex("address_street",["street"],{unique:!1}),e.createIndex("address_addressName",["addressName"],{unique:!0}),e.createIndex("address_street_suburb_city_postal",["street","neighborhood","city","postalCode"],{unique:!0})},this.checkoutDB.onsuccess=()=>{const e=this.checkoutDB.result.transaction("addresses","readwrite");this.addresses=e.objectStore("addresses"),e.oncomplete=()=>{}}}store(){return this.checkoutDB.result.transaction("addresses","readwrite").objectStore("addresses")}loadAddresses(e){const t=e.map((e=>this.addOrUpdateAddress(e)));return Promise.all(t).then((e=>e))}addOrUpdateAddress(e){const t=this;return new Promise(((s,a)=>{const n=t.store().put(e);n.onsuccess=()=>{s({success:!0,addressId:n.result})},n.onerror=e=>{a(new Error({sucess:!1,error:e?.target?.error}))}}))}getAddresses(){const e=this;return new Promise((t=>{const s=e.store().getAll();s.onsuccess=()=>t(s.result),s.onerror=()=>{console.error("Something wrong with getAddresses ? ..."),t([])}}))}getAddress(e){const t=this;return new Promise((s=>{const a=t.store().get(e);a.onsuccess=()=>s(a.result),a.onerror=()=>{console.error("Something wrong with getAddress ? ..."),s([])}}))}deleteAddress(e){const t=this.addresses.delete(e);t.onsuccess=()=>t.result}clearData(){const e=this;return new Promise((t=>{const s=e.store().clear();s.onsuccess=()=>{console.info("clearData success"),t(s.result)},s.onerror=()=>{console.error("Something wrong with clearData ? ..."),t([])}}))}},j=e=>{let t=$(`#address-${e.addressName}`);t.length?(t.after(S(e)),t.remove(),t=null):$("#bash-address-list").append(S(e)),$('input[type="radio"][name="selected-address"]:checked').attr("checked",!1),$(`input[type="radio"][name="selected-address"][value="${e.addressName}"]`).attr("checked",!0)},N=async e=>{if(!e.addressName){const t=e.street.replace(/[^a-zA-Z0-9]/g," ").trim().replace(/\s/g,"-").toLowerCase();e.addressName=`${Date.now()}-${t}`}e.addressId||(e.addressId=e.addressName),T.addOrUpdateAddress(e).then((()=>j(e))),(async e=>{let t;const{email:s}=window.vtexjs.checkout.orderForm.clientProfileData;if(!e)return Promise.reject(new Error("No address provided."));const a=e.addressName?await(async(e,t)=>{let s={};const a={headers:A({cookie:!0,cache:!0,json:!1}),credentials:"include"},n=await fetch(`${l}masterdata/addresses/?_fields=id&_where=addressName=${e}&timestamp=${Date.now()}`,a).then((e=>e.json())).catch((e=>I(`GET_ADDRESS_ERROR: ${e?.message}`)));return n&&!n.error&&n.data&&n.data.length>0&&([s]=n.data),s})(e.addressName):{};t=a?.id?`${l}masterdata/address/${a.id}`:`${l}masterdata/addresses`,e.complement=e.complement||u();const n={userId:s,...e};a.id||(n.addressName=e.addressId||`address-${Date.now()}`);const i={method:"PATCH",headers:A({cookie:!0,cache:!0,json:!0}),body:JSON.stringify(n),credentials:"include"};await fetch(t,i).then((e=>204!==e.status?e.json():e)).then((e=>e)).catch((e=>I(`SAVE_ADDRESS_ERROR: ${e?.message}`)))})(e)},E=async e=>T.getAddress(e),P=async(e,t)=>{const{orderFormId:s}=window.vtexjs.checkout.orderForm,a=`/api/checkout/pub/orderForm/${s}/customData/${e}`,n=JSON.stringify(t);return fetch(a,{method:"PUT",headers:{"Content-Type":"application/json"},body:n})},R=async e=>{const{customData:t}=window.vtexjs.checkout.orderForm;let s={};return t&&t.customApps&&t.customApps.length>0&&t.customApps.forEach((t=>{t.id===e&&(s=t.fields)})),s},_=()=>((async()=>{const e=await T.getAddresses();if(e.length>0)return{data:e};const{email:t}=window.vtexjs.checkout.orderForm?.clientProfileData,s=["id","addressType","addressQuery","addressName","reference","number","geolocation","receiverName","complement","companyBuilding","street","neighborhood","city","postalCode","state","country","buildingType","parkingDistance","deliveryFloor","liftOrStairs","hasSufficientSpace","assembleFurniture","tvID"].join(","),a={headers:A({cookie:!0,cache:!0,json:!1}),credentials:"include"},n=Date.now();return fetch(`${l}masterdata/addresses?t=${n}&_fields=${s}&_where=${encodeURIComponent(`userIdQuery=${t}`)}`,a).then((e=>e.json())).then((async e=>(e.data&&T.loadAddresses(e.data),e))).catch((e=>I(`GET_ADDRESSES_ERROR: ${e?.message}`)))})().then((({data:e})=>{const t=e.map((e=>S(e)));document.getElementById("bash-address-list").innerHTML=t.join(""),k()})).catch((e=>{throw console.error("ERROR getAddresses",e),new Error("Error getAddresses",e.message)})),'\n <div class="bash--addresses shimmer" id="bash-address-list">\n    Loading addresses...\n  </div>  \n  '),O=({label:e,name:t,value:s="",required:a=!0,type:n="text",placeholder:i,autoComplete:r="on",maxLength:o,minlength:d,disabled:l=!1,options:c,checked:p,error:u="This field is required."})=>{const m=t.replace(/\s/g,"-");return`\n<p class="input bash--${n}field-${t.replace(/\s/g,"-")} bash--${n} ${a?"required":"optional"}">\n  ${e&&"checkbox"!==n?`<label id="bash--label-${m}" for="bash--input-${m}">${e}</label>`:""}\n ${(()=>{switch(n){case"radio":return C({name:t,options:c});case"dropdown":return(({name:e,disabled:t=!1,options:s,required:a})=>{const n=s.find((e=>!0===e.selected));return`\n  <select \n    name="${e}" \n    ${a?" required ":""} \n    ${t?" disabled ":""} \n    id="bash--input-${e}" \n    class="input-large" \n  >\n  ${s.map((({value:e,label:t,selected:s},a)=>`\n    <option \n    ${0===a?" disabled ":""}\n    ${0!==a||n?"":" selected "}\n    ${s?" selected ":""}\n      value="${e}" \n    >${t}</option>\n    `)).join("")}\n  </select>\n  `})({name:t,disabled:l,options:c,required:a});case"note":return(({value:e,name:t})=>`\n  <div class="bash--note-field ${t}">\n  ${e}\n  </div>\n  `)({name:t,value:s});case"checkbox":return(({name:e,label:t,checked:s})=>`\n \n  <p class="tfg-custom-checkbox">\n    <label class="tfg-checkbox-label">\n       <input \n        type='checkbox' \n        name="${e}" \n        id="bash--input-${e}" ${s?"checked='checked'":""}\n        value="true" \n        /> ${t} </label>\n  </p>\n  `)({name:t,label:e,checked:p});default:return(({name:e,value:t="",required:s=!0,type:a="text",placeholder:n,autoComplete:i="on",minLength:r=0,maxLength:o=0})=>`\n  <input \n    ${s?" required ":""}\n    autocomplete="${i}" \n    id="bash--input-${e.replace(/\s/g,"-")}" \n    type="${a}" \n    name="${e}" \n    ${r>0?`minlength="${r}"`:""}\n    ${o>0?`maxlength="${o}"`:""}\n    placeholder="${n??""}" \n    class="input-xlarge" \n    value="${t}" \n  />\n`)({name:t,value:s,required:a,type:n,placeholder:i,autoComplete:r,maxLength:o,minlength:d})}})()}\n  ${a?`<span class="bash--field-error">${u}</span>`:""}\n\n</p>  \n`},B=["receiverName","complement","street","neighborhood","state","city","country","postalCode"],q=["buildingType","assembleFurniture","deliveryFloor","hasSufficientSpace","liftOrStairs","parkingDistance"],V=["idOrPassport","sameAddress","fullName","streetAddress","suburb","city","postalCode","province"],L=["tvID"],M=["residential","inStore","commercial","giftRegistry","pickup","search"],G=e=>{switch(e){case"Select":return"";case"Western Cape":return"WC";case"Easter Cape":return"EC";case"Gauteng":return"GP";case"KwaZulu-Natal":case"KwaZulu Natal":return"KZN";case"Northern Cape":return"NC";case"Limpopo":return"LP";case"Mpumalanga":return"MP";case"North West":return"NW";case"Freestate":case"Free State":return"FS";default:return e}},W=e=>{const{street:t,neighborhood:s,postalCode:a,state:n,city:i,receiverName:r,complement:o,id:d,addressId:l,addressName:c}=e;document.getElementById("bash--address-form").reset(),r&&(document.getElementById("bash--input-receiverName").value=r),o&&(document.getElementById("bash--input-complement").value=o),(d||l)&&(document.getElementById("bash--input-addressId").value=d||l),c&&(document.getElementById("bash--input-addressName").value=c),document.getElementById("bash--input-number").value="",document.getElementById("bash--input-street").value=t,document.getElementById("bash--input-neighborhood").value=s,document.getElementById("bash--input-city").value=i,document.getElementById("bash--input-postalCode").value=a,document.getElementById("bash--input-state").value=G(n)},U=(e,t,s="")=>{for(let a=0;a<t.length;a++){const n=`bash--input-${s}${t[a]}`;document.getElementById(n)&&e[t[a]]&&!document.getElementById(n).value&&(document.getElementById(n).value=e[t[a]])}},Z=(e,t=!0)=>{const{items:s}=window.vtexjs.checkout.orderForm,{hasFurniture:a,hasTVs:n,hasSimCards:i}=x(s);let r=[];const o=[];r=[...B],a&&t&&(r=[...r,...q]),n&&t&&(r=[...r,...L]),i&&t&&(r=[...r,...V]);for(let t=0;t<r.length;t++)e[r[t]]||o.push(r[t]);return{isValid:!o.length,invalidFields:o}},H=(e,t={validateExtraFields:!0})=>{const{validateExtraFields:s}=t,{items:a}=window.vtexjs.checkout.orderForm,{hasFurniture:n,hasTVs:i}=x(a);n&&U(e,q),i&&U(e,V,"tv_");const{isValid:r,invalidFields:o}=Z(e,s);if(!r)return W(e),$("#bash--address-form").addClass("show-form-errors"),s&&$("#bash--delivery-form")?.addClass("show-form-errors"),$(`#bash--input-${o[0]}`).focus(),void(B.includes(o[0])&&window.postMessage({action:"setDeliveryView",view:"address-form"}));"business"===e.addressType&&(e.addressType="commercial"),M.includes(e.addressType)||(e.addressType="residential");const{shippingData:d}=window?.vtexjs?.checkout?.orderForm;d.address=e,d.address.number=d.address.number??" ",d.selectedAddresses=[e],document.querySelector(".bash--delivery-container").classList.add("shimmer"),window.vtexjs.checkout.sendAttachment("shippingData",d).then((()=>{e.addressName&&j(d.address)})).done((()=>k()))},J=async e=>{e.preventDefault();const t=document.forms["bash--address-form"],s=$("#bash--input-addressName").val(),a=["addressId","addressName","addressType","receiverName","postalCode","city","state","country","street","neighborhood","complement"],n={isDisposable:!1,reference:null,geoCoordinates:[],number:"",country:"ZAF",...await E(s)};for(let e=0;e<a.length;e++)n[a[e]]=t[a[e]]?.value||null;n.addressName=n.addressName||n.addressId,n.addressId=n.addressId||n.addressName;const{isValid:i,invalidFields:r}=Z(n,!1);if(!i)return $("#bash--address-form").addClass("show-form-errors"),$(`#bash--input-${r[0]}`).focus(),void(B.includes(r[0])&&window.postMessage({action:"setDeliveryView",view:"address-form"}));await H(n,{validateExtraFields:!1}),await N(n),window.postMessage({action:"setDeliveryView",view:"select-address"})},K=async e=>{e.preventDefault();const{items:t}=window.vtexjs.checkout.orderForm,{address:s}=window.vtexjs.checkout.orderForm.shippingData,{hasFurniture:a,hasTVs:n,hasSimCards:i}=x(t);let l={};const c=await E($("[name='selected-address']:checked").val());l={...s,...c};const p={},u={},m={};if(a){const e=q;for(let t=0;t<e.length;t++)s[e[t]]||(l[e[t]]=$(`#bash--input-${e[t]}`).val()),p[e[t]]=$(`#bash--input-${e[t]}`).val();const t=await P(d,p);console.info({furnitureDataSent:t})}if(i){const e=V;for(let t=0;t<e.length;t++)u[e[t]]=$(`#bash--input-rica_${e[t]}`).val();const t=await P(r,u);console.info({ricaDataSent:t})}if(n){const e=L;for(let t=0;t<e.length;t++)s[e[t]]||(l[e[t]]=$(`#bash--input-tv_${e[t]}`).val()),m[e[t]]=$(`#bash--input-tv_${e[t]}`).val();const t=await P(o,m);console.info({tvDataSent:t})}await N(l),window.location.hash="payment"},z=()=>{const e=window?.vtexjs?.checkout?.orderForm?.shippingData?.address?.receiverName,t=window?.vtexjs?.checkout?.orderForm?.clientProfileData?.firstName,s=window?.vtexjs?.checkout?.orderForm?.clientProfileData?.lastName,a=`${t??""} ${s??""}`.trim();return e||document.getElementById("client-first-name")?.value||a},Q=()=>(setTimeout((()=>{(()=>{const e=document.getElementById("bash--input-address-search"),t=new window.google.maps.places.Autocomplete(e,{componentRestrictions:{country:"ZA"}});window.google.maps.event.addListener(t,"place_changed",(()=>{const e=t.getPlace(),{address_components:s,geometry:a}=e;(e=>{const{street:t,neighborhood:s,postalCode:a,state:n,city:i}=e;document.getElementById("bash--address-form").reset(),document.getElementById("bash--input-number").value="",document.getElementById("bash--input-street").value=t,document.getElementById("bash--input-neighborhood").value=s,document.getElementById("bash--input-city").value=i,document.getElementById("bash--input-postalCode").value=a,document.getElementById("bash--input-state").value=G(n)})(((e,t)=>{const s=e.find((e=>e.types.includes("street_number")))?.long_name,a=e.find((e=>e.types.includes("route")))?.long_name,n=e.find((e=>e.types.includes("sublocality")))?.long_name,i=e.find((e=>e.types.includes("locality")))?.long_name,r=e.find((e=>e.types.includes("postal_code")))?.long_name,o=e.find((e=>e.types.includes("administrative_area_level_1")))?.long_name,d={lat:"",lng:""};return t&&(d.lat=t.location.lat(),d.lng=t.location.lng()),{street:`${s??""} ${a??""}`.trim(),neighborhood:n,city:i,postalCode:r,state:o,...d}})(s,a)),window.postMessage({action:"setDeliveryView",view:"address-form"})}))})()}),500),O({name:"address-search",placeholder:"Start typing an address...",autoComplete:"off"})),Y=({hasFurn:e})=>`\n  <div class="bash--delivery-container" id="bash--delivery-container" data-view="select-address">\n  \n   <form id="bash--delivery-form" name="bash--delivery-form" method="post">\n\n    <section class="bash--delivery-view" data-section="select-address">\n    <div class="bash--heading">\n        <h2>Delivery address</h2>\n        <a href="#" data-view="address-search">Add address</a>\n      </div>\n      ${_()}\n    </section>\n\n    <section id="bash-delivery-options" class="shipping-method bash--delivery-view" data-section="select-address">\n      <hr>\n      <div class="bash--heading">\n        <h2>Delivery options</h2>\n        ${e?c:""}\n      </div>\n      <button \n        class="submit btn-go-to-payment btn btn-large btn-success"\n        id="btn-save-delivery" \n        type="submit"a>\n        Go to payment\n      </button>\n    </section>\n   </form>\n\n    <section class="bash--delivery-view" data-section="address-search">\n      <div class="bash--heading">\n        <h2>Add a new delivery address</h2>\n        <a href="#" data-view="select-address">&lt; Back</a>\n      </div>\n      ${Q()} \n    </section>\n    \n    <section class="bash--delivery-view" data-section="address-form">\n       <div class="bash--heading">\n        <h2>Delivery address</h2>\n        <a href="#" class="back-button--search" data-view="address-search">&lt; Back</a>\n        <a href="#" class="back-button--select" data-view="select-address">&lt; Back</a>\n      </div>\n      \n  <form id="bash--address-form" method="post">\n    ${[{name:"addressId",type:"hidden",value:"",required:!1},{name:"addressName",type:"hidden",value:"",required:!1},{name:"street",label:"Street address",required:!0,value:""},{name:"addressType",label:"Address type",required:!0,type:"radio",options:[{value:"residential",label:"Residential",checked:!0},{value:"business",label:"Business"}]},{name:"number",label:"Building/Complex and number",required:!1,value:""},{name:"neighborhood",label:"Suburb",value:""},{name:"city",label:"City",required:!0,value:""},{name:"postalCode",label:"Postal code",value:"",type:"tel",minlength:4,maxLength:4},{type:"note",required:!1,name:"suburb-postal-reminder",value:"Make sure to specify the correct Suburb and Postal code so we can easily find your address."},{name:"state",label:"Province",type:"dropdown",options:[{value:"",label:"Select"},{value:"EC",label:"Eastern Cape"},{value:"FS",label:"Free State"},{value:"GP",label:"Gauteng"},{value:"KZN",label:"KwaZulu-Natal"},{value:"LP",label:"Limpopo"},{value:"MP",label:"Mpumalanga"},{value:"NC",label:"Northern Cape"},{value:"NW",label:"North West"},{value:"WC",label:"Western Cape"}]},{type:"note",required:!1,name:"country-display",label:"Country",value:"South Africa"},{type:"hidden",required:!0,name:"country",value:"ZAF"},{name:"receiverName",label:"Recipient’s name",required:!0,value:z()},{name:"complement",label:"Recipient’s mobile number",required:!0,value:u(),type:"tel",helperText:"We send shipping updates to this number."}].map((e=>O(e))).join("")}\n\n    <button \n      class="submit btn-go-to-payment btn btn-large btn-success"\n      id="btn-save-address" \n      type="submit"\n    >\n      Save address\n    </button>\n  </form>\n  \n  \n    </section>\n\n    <section class="shipping-method" data-section="delivery-options">\n      <hr>\n      <div class="bash--heading">\n        <div class="shipping-section-title">\n          <h2>Delivery options</h2>\n          ${e?c:"<div></div>"}\n        </div>\n      </div>\n    </section>\n\n    <section class="bash--delivery-view" data-section="complete-address">\n      <h2>Complete address</h2>\n      <a href="#" data-view="select-address">&lt; Back</a>\n    </section>\n\n    <section class="bash--delivery-view" data-section="edit-address">\n      <h2>Edit address</h2>\n      <a href="#" data-view="select-address">&lt; Back</a>\n    </section>\n    \n  </div>`,X={buildingType:[{value:"",label:"Please select",disabled:!0},{value:"freeStanding",label:"Free standing"},{value:"houseInComplex",label:"House in complex"},{value:"townhouse",label:"Townhouse"},{value:"apartment",label:"Apartment"}],parkingDistance:[{value:"",label:"Please select",disabled:!0},{value:15,label:"15 meters or less"},{value:25,label:"25 meters"},{value:50,label:"50 meters"},{value:100,label:"100 meters or more"}],deliveryFloor:[{value:"",label:"Please select",disabled:!0},{value:"ground",label:"Ground"},{value:"1",label:"1"},{value:"2",label:"2"},{value:"3+",label:"3+"}],liftOrStairs:[{value:"",label:"Please select",disabled:!0},{value:"lift",label:"Lift"},{value:"stairs",label:"Stairs"}]},ee=({hasFurn:e,hasTV:t,hasSim:s})=>{const a=`\n    <div id="furniture-form">\n      <hr>\n      <div class="bash--heading">\n        <h2>Furniture information needed</h2>\n      </div>\n      <p class="tfg-custom-subtitle">\n        We need some more information to prepare delivery of your furniture items to your address.\n        <br>\n        <br>\n        Please ensure sufficient space to receive the goods and keep in mind \n        that our couriers aren't able to hoist goods onto balconies.\n      </p>\n      ${(()=>{const{buildingType:e,parkingDistance:t,deliveryFloor:s,liftOrStairs:a}=X;return`\n    ${[{name:"buildingType",label:"Building Type",required:!0,type:"dropdown",options:e},{name:"parkingDistance",label:"Parking Distance",required:!0,type:"dropdown",options:t},{name:"deliveryFloor",label:"Delivery Floor",required:!0,type:"dropdown",options:s},{name:"liftOrStairs",label:"Lift or Stairs",required:!0,type:"dropdown",options:a},{name:"hasSufficientSpace",label:"Is there sufficent corner/passage door space?",value:!1,type:"checkbox",checked:!1},{name:"assembleFurniture",label:"Would you like us to assemble your furniture items?",type:"checkbox",value:!1,checked:!1}].map((e=>O(e))).join("")}\n  `})()}\n    </div>\n  `,n=`\n    <div id="tv-license-form">\n      <hr>\n      <div class="bash--heading" style="flex-direction: column; align-items: flex-start;">\n        <h3>TV license information needed</h3>\n        <p class="tfg-custom-subtitle">Please provide your ID number to validate your TV Licence.</p>\n      </div>\n      \n    ${O({name:"tv_tvID",label:"SA ID number",required:!0,value:"",minLength:8,maxLength:13})}\n  \n    </div>\n  `,i=`\n    <div id="rica-form">\n      <hr>\n      <div class="bash--heading" style="flex-direction: column; align-items: flex-start;">\n        <h3>Rica information required</h3>\n        <p class="tfg-custom-subtitle">\n          To RICA your SIM card, provide your SA ID (or foreign passport) number and your address as\n          it appears on a valid proof of residence.\n        </p> \n      </div>\n        ${(()=>{const{shippingData:{selectedAddress:e}}=window.vtexjs.checkout.orderForm,t=[{name:"rica_fullName",label:"Full name and surname",required:!0,value:z()||""},{name:"rica_streetAddress",label:"Street address",required:!0,value:e?.street||""},{name:"rica_suburb",label:"Suburb",value:e?.neighborhood||""},{name:"rica_city",label:"City",required:!0,value:e?.city||""},{name:"rica_postalCode",label:"Postal code",value:e?.postalCode||"",type:"tel",minlength:4,maxLength:4},{name:"rica_province",label:"Province",type:"dropdown",options:[{value:"",label:"Select",disabled:!0},{value:"EC",label:"Eastern Cape"},{value:"FS",label:"Free State"},{value:"GP",label:"Gauteng"},{value:"KZN",label:"KwaZulu-Natal"},{value:"LP",label:"Limpopo"},{value:"MP",label:"Mpumalanga"},{value:"NC",label:"Northern Cape"},{value:"NW",label:"North West"},{value:"WC",label:"Western Cape"}]},{type:"note",required:!1,name:"rica-country-display",label:"Country",value:"South Africa"},{type:"hidden",required:!0,name:"country",value:"ZAF"}];return`\n    ${[{name:"rica_idOrPassport",label:"ID or Passport number",required:!0,value:"",minLength:8,maxLength:13},{name:"rica_sameAddress",label:"Residential address the same as delivery address",type:"checkbox",checked:!0}].map((e=>O(e))).join("")}\n    <div class="rica-conditional-fields">\n    ${t.map((e=>O(e))).join("")}\n    </div>\n  `})()}\n    </div>\n    `;return`\n  <section class="bash--extra-fields bash--delivery-view" data-section="select-address">\n    ${e?a:""}\n    ${t?n:""}\n    ${s?i:""}\n  </section>`},te=(()=>{const e={view:"list",hasFurn:!1,hasTVs:!1,hasSim:!1},t=()=>{if(!$("#bash--delivery-container").length){if(window.vtexjs.checkout.orderForm){const{items:t}=window.vtexjs.checkout.orderForm,{hasFurniture:s,hasTVs:a,hasSimCards:n}=x(t);e.hasFurn=s,e.hasTVs=a,e.hasSim=n}$(".shipping-data .box-step").append(Y({hasFurn:e.hasFurn})),(e.hasFurn||e.hasSim||e.hasTVs)&&($("#bash-delivery-options").before(ee({hasFurn:e.hasFurn,hasSim:e.hasSim,hasTV:e.hasTVs})),e.hasFurn&&(async()=>{const e=await R(d);console.info("populateFurnitureFields",{data:e}),U(e,q)})(),e.hasSim&&(async()=>{const e=await R(r);console.info("populateRicaFields",{data:e}),U(e,V,"rica_")})(),e.hasTVs&&(async()=>{const e=await R(o);console.info("populateTVFields",{data:e}),U(e,L,"tv")})()),$("#delivery-packages-options").clone().appendTo("#bash-delivery-options"),$("select, input").off("invalid"),$("select, input").on("invalid",(function(){$(this[0]).parents("form").addClass("show-form-errors"),$(this)[0].setCustomValidity(" ")})).on("change keyUp",(function(){$(this)[0].setCustomValidity("")}))}};return $(document).ready((()=>{window.location.hash===a?(t(),$(".bash--delivery-container.hide").removeClass("hide")):$(".bash--delivery-container:not(.hide)").length&&$(".bash--delivery-container:not(.hide)").addClass("hide")})),$(window).on("hashchange",(()=>{window.location.hash===a?(console.info("Hash change"),t(),$(".bash--delivery-container.hide").removeClass("hide")):$(".bash--delivery-container:not(.hide)").length&&$(".bash--delivery-container:not(.hide)").addClass("hide")})),$(window).on("orderFormUpdated.vtex",(()=>{const{addressType:e}=window.vtexjs.checkout.orderForm.shippingData.address;"search"===e?($("#shipping-data:not(collection-active)").addClass("collection-active"),$(".delivery-active").removeClass("delivery-active")):(t(),$("#shipping-data:not(delivery-active)").addClass("delivery-active"),$(".collection-active").removeClass("collection-active")),(()=>{const{items:e}=window.vtexjs.checkout.orderForm,{hasFurniture:t,hasTVs:s,hasSimCards:a}=x(e),n="#shipping-data";t?$(`${n}:not(.has-furniture)`).addClass("has-furniture"):$(`${n}.has-furniture`).removeClass("has-furniture"),s?$(`${n}:not(.has-tv)`).addClass("has-tv"):$(`${n}.has-tv`).removeClass("has-tv"),a?$(`${n}:not(.has-rica)`).addClass("has-rica"):$(`${n}.has-rica`).removeClass("has-rica")})()})),$(document).on("click","a[data-view]",(function(e){e.preventDefault();const t=$(this).data("view"),s=decodeURIComponent($(this).data("content"));window.postMessage({action:"setDeliveryView",view:t,content:s})})),$(document).on("change",'input[type="radio"][name="selected-address"]',(function(){const e=(t=$(this).parents(".bash--address-listing").data("address"),JSON.parse(decodeURIComponent(t)));var t;document.forms["bash--delivery-form"]&&(document.forms["bash--delivery-form"].reset(),document.forms["bash--delivery-form"].classList.remove("show-form-errors")),E(e.addressName).then((t=>{H(t||e,{validateExtraFields:!1}),$('input[type="radio"][name="selected-address"]:checked').attr("checked",!1),$(this).attr("checked",!0)}))})),$(document).on("submit","#bash--address-form",J),$(document).on("submit","#bash--delivery-form",K),window.addEventListener("message",(e=>{const{data:t}=e;if(t&&t.action)if("setDeliveryView"===t.action){if(document.querySelector(".bash--delivery-container").setAttribute("data-view",t.view),("address-form"===t.view||"address-edit"===t.view)&&t.content){const e=JSON.parse(decodeURIComponent($(`#${t.content}`).data("address")));W(e)}}else console.error("Unknown action",t.action)})),{state:e,init:()=>{}}})(),se=(()=>{const t={showFurnitureForm:!1,showTVIDForm:!1,showRICAForm:!1,showTVorRICAMsg:!1,showMixedProductsMsg:!1,runningObserver:!1},s=()=>{const s=$("#tfg-custom-rica-msg").length>0,a=$("#tfg-custom-tvid-step").length>0,n=$("#tfg-custom-furniture-step").length>0,i=$("#tfg-custom-tvrica-msg").length>0,r=$("#tfg-custom-mixed-msg").length>0;let o=!1;var d;t.showRICAForm&&!s&&($(".vtex-omnishipping-1-x-deliveryGroup").prepend('\n  <div id="tfg-custom-rica-msg" class="tfg-custom-step">\n    <p class="tfg-custom-title">RICA information required</p>\n    <p class="tfg-custom-subtitle">\n      To RICA your SIM card, provide your SA ID (or foreign passport) number and your address as\n      it appears on a valid proof of residence.\n    </p>\n    <p class="input tfg-custom-input tfg-rica-id-passport">\n      <label>ID or passport number</label>\n      <input id="tfg-rica-id-passport" type="text" class="input-xlarge tfg-input">\n    </p>\n    <label class="tfg-mtop10">Proof of residential address</label>\n    <p class="tfg-custom-checkbox">\n      <label class="tfg-checkbox-label">\n        <input type=\'checkbox\' id="tfg-rica-same-address" checked/>\n        <span class="tfg-checkbox-text">Residential address the same as Delivery address</span>\n      </label>\n    </p>\n    <p class="input tfg-custom-input tfg-rica-fullname">\n      <label>Full name and surname</label>\n      <input id="tfg-rica-fullname" type="text" class="input-xlarge tfg-input rica-field">\n    </p>\n    <p class="input tfg-custom-input tfg-rica-street">\n      <label>Street address</label>\n      <input id="tfg-rica-street" type="text" class="input-xlarge tfg-input rica-field">\n    </p>\n    <p class="input tfg-custom-input tfg-rica-suburb">\n      <label>Suburb</label>\n      <input id="tfg-rica-suburb" type="text" class="input-xlarge tfg-input rica-field">\n    </p>\n    <p class="input tfg-custom-input tfg-rica-city">\n      <label>City</label>\n      <input id="tfg-rica-city" type="text" class="input-xlarge tfg-input rica-field">\n    </p>\n    <p class="input tfg-custom-input tfg-rica-postal-code">\n      <label>Postal code</label>\n      <input id="tfg-rica-postal-code" type="text" class="input-xlarge tfg-input rica-field">\n    </p>\n    <p class="input tfg-rica-province tfg-custom-input">\n      <label>Province</label>\n      <select class="input-xlarge tfg-custom-selector rica-field" id="tfg-rica-province">\n        <option value="" disabled selected>State</option>\n        <option value="EC">Eastern Cape</option>\n        <option value="FS">Free State</option>\n        <option value="GP">Gauteng</option>\n        <option value="KZN">KwaZulu-Natal</option>\n        <option value="LP">Limpopo</option>\n        <option value="MP">Mpumalanga</option>\n        <option value="NC">Northern Cape</option>\n        <option value="NW">North West</option>\n        <option value="WC">Western Cape</option>\n      </select>\n    </p>\n    <p class="input tfg-rica-country tfg-custom-input">\n      <label>Country</label>\n      <select class="input-xlarge tfg-custom-selector" id="tfg-rica-country" disabled>\n        <option value="ZAF" selected>South Africa</option>\n      </select>\n    </p>\n  </div>\n'),$("#tfg-rica-same-address").trigger("change"),o=!0),t.showTVIDForm&&!a&&($(".vtex-omnishipping-1-x-deliveryGroup").prepend('\n    <div id="tfg-custom-tvid-step" class="tfg-custom-step">\n        <p class="tfg-custom-title">TV licence required</p>\n        <p class="tfg-custom-subtitle">Please provide your ID number to validate your TV Licence.</p>\n        <p class="input tfg-custom-input tfg-tv-licence">\n            <label>SA ID number</label>\n            <input id="tfg-tv-licence" type="tel" class="input-xlarge tfg-input">\n        </p>\n    </div>\n'),o=!0),t.showFurnitureForm&&!n&&($(".vtex-omnishipping-1-x-deliveryGroup").prepend((()=>{const{buildingType:t,parkingDistance:s,deliveryFloor:a,liftOrStairs:n}=e;let i='\n    <p class="input tfg-custom-input tfg-building-type">\n      <label>Building type</label>\n      <select class="input-xlarge tfg-custom-selector" id="tfg-building-type">\n        <option disabled selected value="">Please select</option>\n    ';t.forEach((e=>{i+=`<option value="${e}">${e}</option>`})),i+="\n      </select>\n    </p>\n    ";let r='\n  <p class="input tfg-custom-input tfg-parking-distance">\n    <label>Distance to parking</label>\n    <select class="input-xlarge tfg-custom-selector" id="tfg-parking-distance">\n      <option disabled selected value="">Please select</option>\n  ';s.forEach((e=>{r+=`<option value="${e}">${e}</option>`})),r+="\n    </select>\n  </p>\n  ";let o='\n  <p class="input tfg-custom-input tfg-delivery-floor">\n    <label>Delivery floor</label>\n    <select class="input-xlarge tfg-custom-selector" id="tfg-delivery-floor">\n      <option disabled selected value="">Please select</option>\n  ';a.forEach((e=>{o+=`<option value="${e}">${e}</option>`})),o+="\n    </select>\n  </p>\n  ";let d='\n  <p class="input tfg-custom-input tfg-lift-stairs">\n    <label>Lift or stairs</label>\n    <select class="input-xlarge tfg-custom-selector" id="tfg-lift-stairs">\n      <option disabled selected value="">Please select</option>\n  ';return n.forEach((e=>{d+=`<option value="${e}">${e}</option>`})),d+="\n    </select>\n  </p>\n  ",`\n    <div id="tfg-custom-furniture-step" class="tfg-custom-step">\n      <p class="tfg-custom-title">Furniture information needed</p>\n      <p class="tfg-custom-subtitle">\n        We need some more information to prepare delivery of your furniture items to your address.\n      </p>\n      ${i}\n      ${r}\n      ${o}\n      ${d}\n      <p class="tfg-custom-checkbox">\n        <label class="tfg-checkbox-label">\n          <input type='checkbox' id="tfg-sufficient-space"/>\n          <span class="tfg-checkbox-text">Is there sufficent corner/passage door space?</span>\n        </label>\n      </p>\n      <p class="tfg-custom-checkbox">\n        <label class="tfg-checkbox-label">\n          <input type='checkbox' id="tfg-assemble-furniture"/>\n          <span class="tfg-checkbox-text">Would you like us to assemble your furniture items?</span>\n        </label>\n      </p>\n    </div>\n  `})()),$(".vtex-omnishipping-1-x-deliveryGroup p.vtex-omnishipping-1-x-shippingSectionTitle").append(c),$("div.subheader").css("display","none"),o=!0),(t.showTVorRICAMsg||t.showMixedProductsMsg)&&($(".vtex-omnishipping-1-x-deliveryChannelsWrapper.custom-disabled").length<1&&($("#shipping-option-delivery").trigger("click"),$(".vtex-omnishipping-1-x-deliveryChannelsWrapper").addClass("custom-disabled")),t.showTVorRICAMsg&&!i&&($(".vtex-omnishipping-1-x-addressFormPart1").prepend('\n  <div id="tfg-custom-tvrica-msg" class="tfg-custom-msg">\n    <p class="tfg-custom-icon"></p>\n    <p class="tfg-custom-text">\n      You can\'t collect this order in store because your cart contains items \n      which require either RICA or TV License validation.\n    </p>\n  </div>\n'),o=!0),t.showMixedProductsMsg&&!r&&($(".vtex-omnishipping-1-x-addressFormPart1").prepend('\n  <div id="tfg-custom-mixed-msg" class="tfg-custom-msg">\n    <p class="tfg-custom-icon"></p>\n    <p class="tfg-custom-text">\n      We\'ll ship your furniture and other items in your cart to the selected address. \n      Only the furniture delivery fee will apply.\n      </p>\n  </div>\n'),o=!0)),o&&(d=".tfg-custom-step",$(d).addClass("custom-step-border"),$(d).last().addClass("last-custom-step-border"))},o=async()=>{if(window.vtexjs.checkout.orderForm){const{address:e}=window.vtexjs.checkout.orderForm.shippingData,{showFurnitureForm:t,showRICAForm:s,showTVIDForm:a}=se.state;s&&y(),e&&await g(t,a)}},d=()=>{setTimeout((()=>{(()=>{if(window.vtexjs.checkout.orderForm){const{items:e}=window.vtexjs.checkout.orderForm,{hasFurniture:s,hasTVs:a,hasSimCards:n,categories:i}=x(e);t.showFurnitureForm=s,t.showTVIDForm=a,t.showRICAForm=n,t.showTVorRICAMsg=t.showTVIDForm||t.showRICAForm,t.showMixedProductsMsg=e.length>1&&s&&!i.every((e=>e===p))}})(),t.showFurnitureForm?$("div.subheader").css("display","none"):$("div.subheader").css("display","block")}),500),window.location.hash!==a&&window.location.hash!==n||setTimeout((()=>{const e=window.vtexjs.checkout?.orderForm?.shippingData?.address;e&&"residential"===e.addressType&&(window.location.hash===a?(setTimeout((()=>{s(),o()}),i),l()):window.location.hash===n&&setTimeout((async()=>{let e=localStorage.getItem("shippingDataCompleted");e?setTimeout((()=>{localStorage.removeItem("shippingDataCompleted")}),5e3):(t.showFurnitureForm||t.showRICAForm||t.showTVIDForm)&&(t.showRICAForm&&(e=(()=>{let e=!1;const t=b(r);return t&&t.idOrPassport&&t.fullName&&t.streetAddress&&t.suburb&&t.city&&t.postalCode&&t.province&&(e=!0),e})()),(t.showFurnitureForm||t.showTVIDForm)&&(e=await(async()=>{let e=!1;if(window.vtexjs.checkout.orderForm&&window.vtexjs.checkout.orderForm.shippingData.address){const{addressId:s}=window.vtexjs.checkout.orderForm.shippingData.address,a="?_fields=buildingType,parkingDistance,deliveryFloor,liftOrStairs,hasSufficientSpace,assembleFurniture,tvID",n=await v(s,a);if(n){let s=!1,a=!1;t.showFurnitureForm&&n.buildingType&&n.deliveryFloor&&n.parkingDistance&&(s=!0,e=!0),t.showTVIDForm&&n.tvID&&(a=!0,e=!0),!t.showFurnitureForm||!t.showTVIDForm||s&&a||(e=!1)}}return e})()),e||(window.location.hash=a))}),1750))}),i)};$(document).ready((()=>{d()})),$(window).on("hashchange orderFormUpdated.vtex",(()=>{d()})),$(document).on("click","#shipping-data .btn-link.vtex-omnishipping-1-x-btnDelivery",(()=>{d()}));const l=()=>{if(t.runningObserver)return;const e=document.querySelector(".shipping-container .box-step"),s=new MutationObserver((()=>{t.runningObserver=!0,window.location.hash===a&&d()}));e&&s.observe(e,{attributes:!1,childList:!0,characterData:!1})};return{state:t,setView:e=>{document.body.setAttribute("data-delivery-view",e)},setDataInCustomFields:o,showCustomSections:s,init:()=>{}}})(),ae=se,ne=(()=>{const e={validForm:!0,runningObserver:!1},s=s=>{$(`#${s}`).length>0&&!$(`#${s}`).attr("disabled")&&!$(`#${s}`).val()?($(`.${s}`).addClass("error"),$(`.${s}`).append(t),$(`.${s} span.error`).show(),e.validForm=!1):$(`.${s}`).removeClass("error")},n=e=>{e.forEach((e=>{s(e)}))},c=()=>{const{showFurnitureForm:t,showRICAForm:a,showTVIDForm:c}=ae.state;if($("span.help.error").remove(),e.validForm=!0,$("div.address-list.vtex-omnishipping-1-x-addressList").length<=0&&(s("ship-receiverName"),w(document.querySelector(".vtex-omnishipping-1-x-address input#ship-complement").value)?$(".vtex-omnishipping-1-x-address .ship-complement").removeClass("error"):($(".vtex-omnishipping-1-x-address .ship-complement").addClass("error"),$(".vtex-omnishipping-1-x-address .ship-complement").append('<span class="help error">This field is required.</span>'),$(".vtex-omnishipping-1-x-address .ship-complement span.error").show(),e.validForm=!1)),ae.state.showFurnitureForm&&n(["tfg-building-type","tfg-parking-distance","tfg-delivery-floor","tfg-lift-stairs"]),ae.state.showRICAForm&&n(["tfg-rica-id-passport","tfg-rica-fullname","tfg-rica-street","tfg-rica-suburb","tfg-rica-city","tfg-rica-postal-code","tfg-rica-province"]),ae.state.showTVIDForm&&s("tfg-tv-licence"),console.log("!! saveShippingForm - state",e),e.validForm,e.validForm){if(a){const e=(()=>{const e={};return e.idOrPassport=$("#tfg-rica-id-passport").val(),e.sameAddress=$("#tfg-rica-same-address").is(":checked"),e.fullName=$("#tfg-rica-fullname").val(),e.streetAddress=$("#tfg-rica-street").val(),e.suburb=$("#tfg-rica-suburb").val(),e.city=$("#tfg-rica-city").val(),e.postalCode=$("#tfg-rica-postal-code").val(),e.province=$("#tfg-rica-province").val(),e.country=$("#tfg-rica-country").val(),e})();f(r,e)}const e={};if(t){const t=(()=>{const e={furnitureReady:!0};return e.buildingType=$("#tfg-building-type").val(),e.parkingDistance=$("#tfg-parking-distance").val(),e.deliveryFloor=$("#tfg-delivery-floor").val(),$("#tfg-lift-stairs").attr("disabled")||(e.liftOrStairs=$("#tfg-lift-stairs").val()),e.hasSufficientSpace=$("#tfg-sufficient-space").is(":checked"),e.assembleFurniture=$("#tfg-assemble-furniture").is(":checked"),e})();f(d,t),Object.assign(e,t)}if(c){const t={tvID:$("#tfg-tv-licence").val()};f(o,t),Object.assign(e,t)}(async(e={})=>{let t;const{email:s}=window.vtexjs.checkout.orderForm.clientProfileData,{address:a}=window.vtexjs.checkout.orderForm.shippingData;if(!a)return;const n=a?.addressId?await v(a.addressId,"?_fields=id"):{};a.addressType=localStorage.getItem("addressType"),t=n?.id?`${l}masterdata/address/${n.id}`:`${l}masterdata/addresses`,a.complement=a.complement||u();const i={userId:s,...a,...e};n.id||(i.addressName=a.addressId);const r={method:"PATCH",headers:h({cookie:!0,cache:!0,json:!0}),body:JSON.stringify(i),credentials:"include"};await fetch(t,r).then((e=>{localStorage.setItem("shippingDataCompleted",!0),204!==e.status&&e.json()})).catch((e=>m(`SAVE_ADDRESS_ERROR: ${e?.message}`)))})(e),setTimeout((()=>{$("#btn-go-to-payment").trigger("click"),(()=>{const e=localStorage.getItem("addressType");window.vtexjs.checkout.getOrderForm().then((t=>{const{shippingData:s}=t;return s.selectedAddresses[0].addressType=e,window.vtexjs.checkout.sendAttachment("shippingData",s)}))})()}),i)}},p=()=>{$("div.address-list").length<1&&$("#shipping-option-delivery").hasClass("shp-method-option-active")&&"address-list"!==$("body").data("delivery-view")?$("body:not(.has-no-addresses)").addClass("has-no-addresses"):$("body.has-no-addresses").removeClass("has-no-addresses"),window.location.hash===a&&setTimeout((()=>{$("#shipping-option-delivery").hasClass("shp-method-option-active")&&(()=>{if($("#custom-go-to-payment").length<=0){const e=$("#btn-go-to-payment"),t=e.clone(!1);$(e).hide(),$(t).data("bind",""),$(t).removeAttr("id").attr("id","custom-go-to-payment"),$(t).removeAttr("data-bind"),$(t).css("display","block"),$("p.btn-go-to-payment-wrapper").append(t),$(t).on("click",c)}})(),g()}),i)},g=()=>{if(e.runningObserver)return;const t=document.querySelector(".shipping-container .box-step"),s=new MutationObserver((()=>{e.runningObserver=!0,window.location.hash!==a||$("btn-link vtex-omnishipping-1-x-btnDelivery").length||p()}));t&&s.observe(t,{attributes:!1,childList:!0,characterData:!1})};return $(document).on("change",".vtex-omnishipping-1-x-deliveryGroup #tfg-delivery-floor",(function(){"Ground"===$(this).val()?($("#tfg-lift-stairs").val(""),$("#tfg-lift-stairs").attr("disabled","disabled"),$("#tfg-lift-stairs").next("span.help.error").remove(),$(".tfg-lift-stairs").removeClass("error")):$("#tfg-lift-stairs").removeAttr("disabled")})),$(document).on("change",".vtex-omnishipping-1-x-deliveryGroup .tfg-custom-selector, .vtex-omnishipping-1-x-deliveryGroup .tfg-input",(function(){$(this).val()?($(this).parent().removeClass("error"),$(this).next("span.help.error").remove(),$(this).addClass("tfg-input-completed")):$(this).removeClass("tfg-input-completed")})),$(document).on("change keyup",".vtex-omnishipping-1-x-addressForm input, #tfg-tv-licence",(function(){$(this).val()&&($(this).parent().removeClass("error"),$(this).next("span.help.error").remove())})),$(document).on("change",".vtex-omnishipping-1-x-deliveryGroup #tfg-rica-same-address",(function(){$(this).is(":checked")?y("shippingAddress"):$(".rica-field").val("")})),$(document).on("click","#shipping-data .btn-link.vtex-omnishipping-1-x-btnDelivery",(()=>{p()})),$(document).ready((()=>{p()})),$(window).on("hashchange orderFormUpdated.vtex",(()=>{p()})),{state:e,init:()=>{}}})();ae.init(),ne.init(),F.init(),te.init()})();