(()=>{"use strict";const e="#/shipping",t="#/payment",s=750,i="ricafields",o=window.location.host.includes("bash.com")?"https://store-api.www.bash.com/custom-api/":`${window.location.protocol}//${window.location.host}/custom-api/`,n="1169288799",r=()=>window.vtexjs.checkout.orderForm?.shippingData?.address?.complement||window.vtexjs.checkout.orderForm?.clientProfileData?.phone||document?.getElementById("client-phone")?.value,a=({cookie:e,cache:t,json:s})=>{const i=new Headers;return e&&i.append("Cookie",document?.cookie),t&&i.append("Cache-Control","no-cache"),s&&i.append("Content-type","application/json"),i},c=async(e,t)=>{let s={};const i={headers:a({cookie:!0,cache:!0,json:!1}),credentials:"include"},n=await fetch(`${o}masterdata/addresses/${t}&_where=addressName=${e}&timestamp=${Date.now()}`,i).then((e=>e.json())).catch((e=>console.error(e)));return n&&!n.error&&n.data&&n.data.length>0&&([s]=n.data),s},l=async(e,t,s=1)=>{if(e||t){const{address:i}=window.vtexjs.checkout.orderForm.shippingData,o="?_fields=buildingType,parkingDistance,deliveryFloor,liftOrStairs,hasSufficientSpace,assembleFurniture,tvID",n=await c(i.addressId,o);n&&!jQuery.isEmptyObject(n)?(e&&($("#tfg-building-type").val(n.buildingType),$("#tfg-parking-distance").val(n.parkingDistance),$("#tfg-delivery-floor").val(n.deliveryFloor),"Ground"===$("#tfg-delivery-floor").val()?$("#tfg-lift-stairs").attr("disabled","disabled"):$("#tfg-lift-stairs").val(n.liftOrStairs),$("#tfg-sufficient-space").prop("checked",n.hasSufficientSpace),$("#tfg-assemble-furniture").prop("checked",n.assembleFurniture)),t&&$("#tfg-tv-licence").val(n.tvID)):s<=5&&setTimeout((()=>{l(e,t,s+=1)}),3e3)}},p=e=>{const{customData:t}=window.vtexjs.checkout.orderForm;let s={};return t&&t.customApps&&t.customApps.length>0&&t.customApps.forEach((t=>{t.id===e&&(s=t.fields)})),s},d=(e,t)=>{const{orderFormId:s}=window.vtexjs.checkout.orderForm;return $.ajax({type:"PUT",url:`/api/checkout/pub/orderForm/${s}/customData/${e}`,dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify(t)})},u=(e="customApps")=>{let t;if("shippingAddress"===e){const{address:e}=window.vtexjs.checkout.orderForm.shippingData;t={idOrPassport:"",sameAddress:"true",fullName:e.receiverName||$("#ship-receiverName").val(),streetAddress:`${e.street}, ${e.number}`,suburb:e.neighborhood,city:e.city,postalCode:e.postalCode,province:e.state}}else"customApps"===e&&(t=p(i));t&&!jQuery.isEmptyObject(t)&&("customApps"===e&&($("#tfg-rica-id-passport").val(t.idOrPassport),$("#tfg-rica-same-address").prop("checked","true"===t.sameAddress)),$("#tfg-rica-fullname").val(t.fullName),$("#tfg-rica-street").val(t.streetAddress),$("#tfg-rica-suburb").val(t.suburb),$("#tfg-rica-city").val(t.city),$("#tfg-rica-postal-code").val(t.postalCode),$("#tfg-rica-province").val(t.province))},m=e=>(e=>!!e&&("0"===(e=e.replace(/\s/g,""))[0]?e.match(/[0-9\s]{10}/):e.match(/[0-9\s]{9,}/)))(e),h=e=>{const t=[n],s=["938942995"],i=["24833302"],o=[];let r=!1,a=!1,c=!1;return e.forEach((e=>{const n=e.productCategoryIds.split("/");o.push(n),n.forEach((e=>{e&&(s.includes(e)&&(r=!0),i.includes(e)&&(a=!0),t.includes(e)&&(c=!0))}))})),{hasFurniture:c,hasSimCards:a,hasTVs:r,categories:o}},g={buildingType:["Free standing","House in complex","Townhouse","Apartment"],parkingDistance:[15,25,50,100],deliveryFloor:["Ground","1","2","3+"],liftStairs:["Lift","Stairs"]},v=()=>'<span class="help error">This field is required.</span>',f=()=>'\n  <p id="box-pickup-complement" class="input custom-field-complement tfg-custom-addressForm">\n    <label>Mobile number</label>\n    <input id="custom-pickup-complement" class="input-xlarge success" type="text" field="complement" placeholder="" />\n  </p>',b=(()=>{const o={showFurnitureForm:!1,showTVIDForm:!1,showRICAForm:!1,showTVorRICAMsg:!1,showMixedProductsMsg:!1,runningObserver:!1},r=()=>{const e=$("#tfg-custom-rica-msg").length>0,t=$("#tfg-custom-tvid-step").length>0,s=$("#tfg-custom-furniture-step").length>0,i=$("#tfg-custom-tvrica-msg").length>0,n=$("#tfg-custom-mixed-msg").length>0;var r;o.showRICAForm&&!e&&($(".vtex-omnishipping-1-x-deliveryGroup").prepend('\n  <div id="tfg-custom-rica-msg" class="tfg-custom-step">\n    <p class="tfg-custom-title">RICA information required</p>\n    <p class="tfg-custom-subtitle">\n      To RICA your SIM card, provide your SA ID (or foreign passport) number and your address as\n      it appears on a valid proof of residence.\n    </p>\n    <p class="input tfg-custom-input tfg-rica-id-passport">\n      <label>ID or passport number</label>\n      <input id="tfg-rica-id-passport" type="text" class="input-xlarge tfg-input">\n    </p>\n    <label class="tfg-mtop10">Proof of residential address</label>\n    <p class="tfg-custom-checkbox">\n      <label class="tfg-checkbox-label">\n        <input type=\'checkbox\' id="tfg-rica-same-address" checked/>\n        <span class="tfg-checkbox-text">Residential address the same as Delivery address</span>\n      </label>\n    </p>\n    <p class="input tfg-custom-input tfg-rica-fullname">\n      <label>Full name and surname</label>\n      <input id="tfg-rica-fullname" type="text" class="input-xlarge tfg-input rica-field">\n    </p>\n    <p class="input tfg-custom-input tfg-rica-street">\n      <label>Street address</label>\n      <input id="tfg-rica-street" type="text" class="input-xlarge tfg-input rica-field">\n    </p>\n    <p class="input tfg-custom-input tfg-rica-suburb">\n      <label>Suburb</label>\n      <input id="tfg-rica-suburb" type="text" class="input-xlarge tfg-input rica-field">\n    </p>\n    <p class="input tfg-custom-input tfg-rica-city">\n      <label>City</label>\n      <input id="tfg-rica-city" type="text" class="input-xlarge tfg-input rica-field">\n    </p>\n    <p class="input tfg-custom-input tfg-rica-postal-code">\n      <label>Postal code</label>\n      <input id="tfg-rica-postal-code" type="text" class="input-xlarge tfg-input rica-field">\n    </p>\n    <p class="input tfg-rica-province tfg-custom-input">\n      <label>Province</label>\n      <select class="input-xlarge tfg-custom-selector rica-field" id="tfg-rica-province">\n        <option value="" disabled selected>State</option>\n        <option value="EC">Eastern Cape</option>\n        <option value="FS">Free State</option>\n        <option value="GP">Gauteng</option>\n        <option value="KZN">KwaZulu-Natal</option>\n        <option value="LP">Limpopo</option>\n        <option value="MP">Mpumalanga</option>\n        <option value="NC">Northern Cape</option>\n        <option value="NW">North West</option>\n        <option value="WC">Western Cape</option>\n      </select>\n    </p>\n    <p class="input tfg-rica-country tfg-custom-input">\n      <label>Country</label>\n      <select class="input-xlarge tfg-custom-selector" id="tfg-rica-country" disabled>\n        <option value="ZAF" selected>South Africa</option>\n      </select>\n    </p>\n  </div>\n'),$("#tfg-rica-same-address").trigger("change")),o.showTVIDForm&&!t&&$(".vtex-omnishipping-1-x-deliveryGroup").prepend('\n    <div id="tfg-custom-tvid-step" class="tfg-custom-step">\n        <p class="tfg-custom-title">TV licence required</p>\n        <p class="tfg-custom-subtitle">Please provide your ID number to validate your TV Licence.</p>\n        <p class="input tfg-custom-input tfg-tv-licence">\n            <label>SA ID number</label>\n            <input id="tfg-tv-licence" type="text" class="input-xlarge tfg-input">\n        </p>\n    </div>\n'),o.showFurnitureForm&&!s&&($(".vtex-omnishipping-1-x-deliveryGroup").prepend((()=>{const{buildingType:e,parkingDistance:t,deliveryFloor:s,liftStairs:i}=g;let o='\n    <p class="input tfg-custom-input tfg-building-type">\n      <label>Building type</label>\n      <select class="input-xlarge tfg-custom-selector" id="tfg-building-type">\n        <option disabled selected value="">Please select</option>\n    ';e.forEach((e=>{o+=`<option value="${e}">${e}</option>`})),o+="\n      </select>\n    </p>\n    ";let n='\n  <p class="input tfg-custom-input tfg-parking-distance">\n    <label>Distance to parking</label>\n    <select class="input-xlarge tfg-custom-selector" id="tfg-parking-distance">\n      <option disabled selected value="">Please select</option>\n  ';t.forEach((e=>{n+=`<option value="${e}">${e}</option>`})),n+="\n    </select>\n  </p>\n  ";let r='\n  <p class="input tfg-custom-input tfg-delivery-floor">\n    <label>Delivery floor</label>\n    <select class="input-xlarge tfg-custom-selector" id="tfg-delivery-floor">\n      <option disabled selected value="">Please select</option>\n  ';s.forEach((e=>{r+=`<option value="${e}">${e}</option>`})),r+="\n    </select>\n  </p>\n  ";let a='\n  <p class="input tfg-custom-input tfg-lift-stairs">\n    <label>Lift or stairs</label>\n    <select class="input-xlarge tfg-custom-selector" id="tfg-lift-stairs">\n      <option disabled selected value="">Please select</option>\n  ';return i.forEach((e=>{a+=`<option value="${e}">${e}</option>`})),a+="\n    </select>\n  </p>\n  ",`\n    <div id="tfg-custom-furniture-step" class="tfg-custom-step">\n      <p class="tfg-custom-title">Furniture information needed</p>\n      <p class="tfg-custom-subtitle">\n        We need some more information to prepare delivery of your furniture items to your address.\n      </p>\n      ${o}\n      ${n}\n      ${r}\n      ${a}\n      <p class="tfg-custom-checkbox">\n        <label class="tfg-checkbox-label">\n          <input type='checkbox' id="tfg-sufficient-space"/>\n          <span class="tfg-checkbox-text">Is there sufficent corner/passage door space?</span>\n        </label>\n      </p>\n      <p class="tfg-custom-checkbox">\n        <label class="tfg-checkbox-label">\n          <input type='checkbox' id="tfg-assemble-furniture"/>\n          <span class="tfg-checkbox-text">Would you like us to assemble your furniture items?</span>\n        </label>\n      </p>\n    </div>\n  `})()),$(".vtex-omnishipping-1-x-deliveryGroup p.vtex-omnishipping-1-x-shippingSectionTitle").append('<a href="http://image.tfgmedia.co.za/image/1/process/500x790?source=http://cdn.tfgmedia.co.za/15/Marketing/HTMLPages/Furniture_Delivery_Fees_tab_image.jpg" class="furniture-fees-link"target="_blank">Furniture delivery costs</a>'),$("div.subheader").css("display","none")),(o.showTVorRICAMsg||o.showMixedProductsMsg)&&($("#shipping-option-delivery").trigger("click"),$(".vtex-omnishipping-1-x-deliveryChannelsWrapper").addClass("custom-disabled"),o.showTVorRICAMsg&&!i&&$(".vtex-omnishipping-1-x-addressFormPart1").prepend('\n  <div id="tfg-custom-tvrica-msg" class="tfg-custom-msg">\n    <p class="tfg-custom-icon"></p>\n    <p class="tfg-custom-text">\n      You can\'t collect this order in store because your cart contains items \n      which require either RICA or TV License validation.\n    </p>\n  </div>\n'),o.showMixedProductsMsg&&!n&&$(".vtex-omnishipping-1-x-addressFormPart1").prepend('\n  <div id="tfg-custom-mixed-msg" class="tfg-custom-msg">\n    <p class="tfg-custom-icon"></p>\n    <p class="tfg-custom-text">\n      We\'ll ship your furniture and other items in your cart to the selected address. \n      Only the furniture delivery fee will apply.\n      </p>\n  </div>\n')),r=".tfg-custom-step",$(r).addClass("custom-step-border"),$(r).last().addClass("last-custom-step-border")},a=async()=>{if(window.vtexjs.checkout.orderForm){const{address:e}=window.vtexjs.checkout.orderForm.shippingData,{showFurnitureForm:t,showRICAForm:s,showTVIDForm:i}=b.state;s&&u(),e&&await l(t,i)}},d=()=>{setTimeout((()=>{(()=>{if(window.vtexjs.checkout.orderForm){const{items:e}=window.vtexjs.checkout.orderForm,{hasFurniture:t,hasTVs:s,hasSimCards:i,categories:r}=h(e);o.showFurnitureForm=t,o.showTVIDForm=s,o.showRICAForm=i,o.showTVorRICAMsg=o.showTVIDForm||o.showRICAForm,o.showMixedProductsMsg=e.length>1&&t&&!r.every((e=>e===n))}})(),o.showFurnitureForm?$("div.subheader").css("display","none"):$("div.subheader").css("display","block")}),500),window.location.hash!==e&&window.location.hash!==t||setTimeout((()=>{const n=window.vtexjs.checkout?.orderForm?.shippingData?.address;n&&"residential"===n.addressType&&(window.location.hash===e?(setTimeout((()=>{r(),a()}),s),m()):window.location.hash===t&&setTimeout((async()=>{let t=localStorage.getItem("shippingDataCompleted");t?setTimeout((()=>{localStorage.removeItem("shippingDataCompleted")}),5e3):(o.showFurnitureForm||o.showRICAForm||o.showTVIDForm)&&(o.showRICAForm&&(t=(()=>{let e=!1;const t=p(i);return t&&t.idOrPassport&&t.fullName&&t.streetAddress&&t.suburb&&t.city&&t.postalCode&&t.province&&(e=!0),e})()),(o.showFurnitureForm||o.showTVIDForm)&&(t=await(async()=>{let e=!1;if(window.vtexjs.checkout.orderForm&&window.vtexjs.checkout.orderForm.shippingData.address){const{addressId:t}=window.vtexjs.checkout.orderForm.shippingData.address,s="?_fields=buildingType,parkingDistance,deliveryFloor,liftOrStairs,hasSufficientSpace,assembleFurniture,tvID",i=await c(t,s);if(i){let t=!1,s=!1;o.showFurnitureForm&&i.buildingType&&i.deliveryFloor&&i.parkingDistance&&(t=!0,e=!0),o.showTVIDForm&&i.tvID&&(s=!0,e=!0),!o.showFurnitureForm||!o.showTVIDForm||t&&s||(e=!1)}}return e})()),t||(window.location.hash=e))}),1750))}),s)};$(document).ready((()=>{d()})),$(window).on("hashchange orderFormUpdated.vtex",(()=>{d()})),$(document).on("click","#shipping-data .btn-link.vtex-omnishipping-1-x-btnDelivery",(()=>{d()}));const m=()=>{if(o.runningObserver)return;const t=document.querySelector(".shipping-container .box-step"),s=new MutationObserver((()=>{o.runningObserver=!0,window.location.hash===e&&d()}));t&&s.observe(t,{attributes:!1,childList:!0,characterData:!1})};return{state:o,setView:e=>{document.body.setAttribute("data-delivery-view",e)},setDataInCustomFields:a}})(),w=b,y=(()=>{const s=()=>{if(!window.vtexjs.checkout.orderForm)return;const{items:s,shippingData:i}=window.vtexjs.checkout.orderForm;if(!i||s.length<1)return;const{address:o}=i,{hasFurniture:n,hasTVs:a,hasSimCards:c}=h(s),l=n||c||a;"search"===o?.addressType&&l&&($("#shipping-data").addClass("shimmer"),$("#shipping-option-delivery").trigger("click"),window.location.hash===t&&window.location.replace(e)),window.location.hash===e&&setTimeout((()=>{const t=$("#shipping-option-delivery").hasClass("shp-method-option-active");$(".btn-go-to-shippping-method").text("Save address"),window.location.hash===e&&t&&((()=>{if(!document.querySelector(".vtex-omnishipping-1-x-address .ship-addressType")){const e=window.vtexjs.checkout.orderForm.shippingData?.address?.addressType;$(".ship-receiverName").after(((e="residential")=>`\n<div class="input ship-addressType text" style="order: 3;">\n   <label>Address type</label>\n    <div class="ship-addressType-container">\n      <div class="ship-addressType-div-residential">\n          <input type="radio" \n            id="ship-addressType-residential" \n            name="ship-addressType" value="residential"\n            ${"residential"===e?' checked="checked" ':""}\n            >\n          <label for="ship-addressType-residential">Residential</label>\n      </div>\n      <div class="ship-addressType-div-business"> \n          <input type="radio" \n            id="ship-addressType-business" \n            name="ship-addressType" value="commercial"\n            ${"commercial"===e?' checked="checked" ':""} \n             >\n          <label for="ship-addressType-business">Business</label>\n      </div>\n    </div>\n</div>`)(e))}})(),(()=>{if(window.vtexjs.checkout.orderForm?.shippingData?.address?.complement||$("#ship-complement").val())return;const e=r();window.vtexjs.checkout.orderForm?.shippingData?.address?.complement||(e=>{window.vtexjs&&e&&!window.vtexjs.checkout.orderForm?.shippingData?.address?.complement&&window.vtexjs.checkout.getOrderForm().then((t=>{const{shippingData:s}=t;return s.address.complement=e,window.vtexjs.checkout.sendAttachment("shippingData",s)}))})(e),""===$("#ship-complement").val()&&$("#ship-complement").val(e)})(),document.getElementById("ship-state")&&"State"===document.getElementById("ship-state")?.options?.[0]?.text&&(document.getElementById("ship-state").options[0].text="Select"))}),500)};return $(document).ready((()=>{s()})),$(window).on("hashchange orderFormUpdated.vtex",(()=>{$(".shimmer").removeClass("shimmer"),s()})),$(document).on("click","#edit-shipping-data",(()=>{s()})),$(document).on("change",'input[name="ship-addressType"]',(()=>{localStorage.setItem("addressType",document.querySelector('input[name="ship-addressType"]:checked').value)})),$(document).on("click","#force-shipping-fields, #edit-address-button",(()=>{w.setDataInCustomFields(),w.setView("edit-address")})),$(document).on("click","#new-address-button",(()=>{w.setView("address-search"),$(".v-custom-ship-street label").text("Search for address"),$("#v-custom-ship-street").attr("placeholder","Start typing and address")})),$(document).on("click","#back-to-address-list",(()=>{w.setView("address-list")})),$(document).on("click",".address-list > label",(()=>{$(".address-list").addClass("shimmer")})),$(document).on("change",'[data-delivery-view="address-search"] #v-custom-ship-street',(()=>{w.setView("add-address"),$(".v-custom-ship-street label").text("Street address"),$("#v-custom-ship-street").attr("placeholder","Eg: 234 Brickfield Rd, Salt River, Cape Town, 7501, South Africa")})),{state:{intTelInput:{},captureGoogleInputOnChange:!1,captureAddressListOnChange:!1}}})(),x=(()=>{const i={inCollect:!1,pickupSelected:!1,validForm:!1,runningObserver:!1},o=()=>{if($("span.help.error").remove(),i.validForm=!0,["pickup-receiver","custom-pickup-complement"].forEach((e=>{let t,s=!0;switch(e){case"pickup-receiver":s=!($(`#${e}`).length>0&&!$(`#${e}`).attr("disabled")&&!$(`#${e}`).val()),t=".shp-pickup-receiver";break;case"custom-pickup-complement":s=m($(`#${e}`).val()),t="#box-pickup-complement"}s?$(t).removeClass("error"):($(t).addClass("error"),$(t).append('<span class="help error">This field is required.</span>'),$(`${t} span.error`).show(),i.validForm=!1)})),i.validForm){let e=$("#custom-pickup-complement").val().replace(/\s/g,"");9===e.length&&"0"!==e[0]&&(e=`0${e}`),localStorage.setItem("saving-shipping-collect",!0),$("#btn-go-to-payment").trigger("click"),setTimeout((()=>{window.vtexjs.checkout.getOrderForm().then((t=>{const{address:s}=t.shippingData;return s.complement=e,window.vtexjs.checkout.calculateShipping(s)})).done((()=>{localStorage.removeItem("saving-shipping-collect")}))}),s)}},n=()=>{const s=$("div#postalCode-finished-loading").length>0;window.location.hash===e&&s?(i.inCollect=$("#shipping-option-pickup-in-point").hasClass("shp-method-option-active"),i.pickupSelected=0===$("div.ask-for-geolocation").length,i.inCollect&&(i.pickupSelected?($("button.shp-pickup-receiver__btn").trigger("click"),$("div.shp-pickup-receiver").addClass("show"),(()=>{const e=window.vtexjs.checkout.orderForm?.clientProfileData?.phone??$("#client-phone").val()??"";0===$("input#custom-pickup-complement").length?($(".btn-go-to-payment-wrapper").before(f),(()=>{const e=document.querySelector("input#custom-pickup-complement");e&&e.setAttribute("placeholder","")})(),e&&$("input#custom-pickup-complement").val(e)):""===$("input#custom-pickup-complement").val()&&($("input#custom-pickup-complement").val(e),window.vtexjs.checkout.getOrderForm().then((t=>{const{shippingData:s}=t;return s.address.complement=e,window.vtexjs.checkout.sendAttachment("shippingData",s)}))),(()=>{const{firstName:e,lastName:t}=window.vtexjs.checkout.orderForm?.clientProfileData,s=$("#client-first-name").val(),i=$("#client-last-name").val(),o=e?[e,t].join(" "):[s,i].join(" ");""===$("input#pickup-receiver").val()&&($("input#pickup-receiver").val(o.trim()),window.vtexjs.checkout.getOrderForm().then((e=>{const{shippingData:t}=e;return t.address.receiverName=o.trim(),window.vtexjs.checkout.sendAttachment("shippingData",t)})))})()})(),(()=>{if($("#custom-go-to-payment").length<=0){const e=$("#btn-go-to-payment"),t=e.clone(!1);$(e).hide(),$(t).data("bind",""),$(t).removeAttr("id").attr("id","custom-go-to-payment"),$(t).removeAttr("data-bind"),$(t).css("display","block"),$("p.btn-go-to-payment-wrapper").append(t),$(t).on("click",o)}})()):$("div.shp-pickup-receiver").removeClass("show"),$("p.vtex-omnishipping-1-x-shippingSectionTitle").text("Collect options"),$("#change-pickup-button").text("Available pickup points"),$("h2.vtex-omnishipping-1-x-geolocationTitle.ask-for-geolocation-title").text("Find nearby Click & Collect points"),$("h3.vtex-omnishipping-1-x-subtitle.ask-for-geolocation-subtitle").text("Search for addresses that you frequently use and we'll locate stores nearby."),i.pickupSelected&&$("label.shp-pickup-receiver__label").text("Recipient's name")),localStorage.getItem("shipping-incomplete-values")&&($("#custom-go-to-payment").trigger("click"),localStorage.removeItem("shipping-incomplete-values"))):($("#box-pickup-complement").remove(),window.location.hash===t&&setTimeout((()=>{const t=window.vtexjs.checkout.orderForm?.shippingData?.address;localStorage.getItem("saving-shipping-collect")||!t||"search"!==t.addressType||t.receiverName&&t.complement||(window.location.hash=e,localStorage.setItem("shipping-incomplete-values",!0))}),1e3)),r()},r=()=>{if(i.runningObserver)return;const e=document.querySelector(".shipping-container .box-step"),t=new MutationObserver((()=>{i.runningObserver=!0,n()}));e&&t.observe(e,{attributes:!1,childList:!0,characterData:!1})};return $(document).ready((()=>{n()})),$(window).on("hashchange orderFormUpdated.vtex",(()=>{n()})),{state:i}})(),k=(()=>{const t={validForm:!0,runningObserver:!1},n=e=>{$(`#${e}`).length>0&&!$(`#${e}`).attr("disabled")&&!$(`#${e}`).val()?($(`.${e}`).addClass("error"),$(`.${e}`).append(v),$(`.${e} span.error`).show(),t.validForm=!1):$(`.${e}`).removeClass("error")},l=e=>{e.forEach((e=>{n(e)}))},p=()=>{const{showFurnitureForm:e,showRICAForm:p,showTVIDForm:u}=w.state;if($("span.help.error").remove(),t.validForm=!0,$("div.address-list.vtex-omnishipping-1-x-addressList").length<=0&&(n("ship-receiverName"),m(document.querySelector(".vtex-omnishipping-1-x-address input#ship-complement").value)?$(".vtex-omnishipping-1-x-address .ship-complement").removeClass("error"):($(".vtex-omnishipping-1-x-address .ship-complement").addClass("error"),$(".vtex-omnishipping-1-x-address .ship-complement").append('<span class="help error">This field is required.</span>'),$(".vtex-omnishipping-1-x-address .ship-complement span.error").show(),t.validForm=!1)),w.state.showFurnitureForm&&l(["tfg-building-type","tfg-parking-distance","tfg-delivery-floor","tfg-lift-stairs"]),w.state.showRICAForm&&l(["tfg-rica-id-passport","tfg-rica-fullname","tfg-rica-street","tfg-rica-suburb","tfg-rica-city","tfg-rica-postal-code","tfg-rica-province"]),w.state.showTVIDForm&&n("tfg-tv-licence"),console.log("!! saveShippingForm - state",t),t.validForm){if(p){const e=(()=>{const e={};return e.idOrPassport=$("#tfg-rica-id-passport").val(),e.sameAddress=$("#tfg-rica-same-address").is(":checked"),e.fullName=$("#tfg-rica-fullname").val(),e.streetAddress=$("#tfg-rica-street").val(),e.suburb=$("#tfg-rica-suburb").val(),e.city=$("#tfg-rica-city").val(),e.postalCode=$("#tfg-rica-postal-code").val(),e.province=$("#tfg-rica-province").val(),e.country=$("#tfg-rica-country").val(),e})();d(i,e)}const t={};if(e){const e=(()=>{const e={furnitureReady:!0};return e.buildingType=$("#tfg-building-type").val(),e.parkingDistance=$("#tfg-parking-distance").val(),e.deliveryFloor=$("#tfg-delivery-floor").val(),$("#tfg-lift-stairs").attr("disabled")||(e.liftOrStairs=$("#tfg-lift-stairs").val()),e.hasSufficientSpace=$("#tfg-sufficient-space").is(":checked"),e.assembleFurniture=$("#tfg-assemble-furniture").is(":checked"),e})();d("furniturefields",e),Object.assign(t,e)}if(u){const e={tvID:$("#tfg-tv-licence").val()};d("tvfields",e),Object.assign(t,e)}(async(e={})=>{let t;const{email:s}=window.vtexjs.checkout.orderForm.clientProfileData,{address:i}=window.vtexjs.checkout.orderForm.shippingData;if(!i)return;const n=i?.addressId?await c(i.addressId,"?_fields=id"):{};i.addressType=localStorage.getItem("addressType"),t=n?.id?`${o}masterdata/address/${n.id}`:`${o}masterdata/addresses`,i.complement=i.complement||r();const l={userId:s,...i,...e};n.id||(l.addressName=i.addressId);const p={method:"PATCH",headers:a({cookie:!0,cache:!0,json:!0}),body:JSON.stringify(l),credentials:"include"};await fetch(t,p).then((e=>{localStorage.setItem("shippingDataCompleted",!0),204!==e.status&&e.json()})).catch((e=>{throw console.error(e),new Error("Could not save address",e)}))})(t),setTimeout((()=>{$("#btn-go-to-payment").trigger("click"),(()=>{const e=localStorage.getItem("addressType");window.vtexjs.checkout.getOrderForm().then((t=>{const{shippingData:s}=t;return s.selectedAddresses[0].addressType=e,window.vtexjs.checkout.sendAttachment("shippingData",s)}))})()}),s)}},h=()=>{$("div.address-list").length<1&&$("#shipping-option-delivery").hasClass("shp-method-option-active")&&"address-list"!==$("body").data("delivery-view")?$("body:not(.has-no-addresses)").addClass("has-no-addresses"):$("body.has-no-addresses").removeClass("has-no-addresses"),window.location.hash===e&&setTimeout((()=>{$("#shipping-option-delivery").hasClass("shp-method-option-active")&&(()=>{if($("#custom-go-to-payment").length<=0){const e=$("#btn-go-to-payment"),t=e.clone(!1);$(e).hide(),$(t).data("bind",""),$(t).removeAttr("id").attr("id","custom-go-to-payment"),$(t).removeAttr("data-bind"),$(t).css("display","block"),$("p.btn-go-to-payment-wrapper").append(t),$(t).on("click",p)}})(),g()}),s)},g=()=>{if(t.runningObserver)return;const s=document.querySelector(".shipping-container .box-step"),i=new MutationObserver((()=>{t.runningObserver=!0,window.location.hash!==e||$("btn-link vtex-omnishipping-1-x-btnDelivery").length||h()}));s&&i.observe(s,{attributes:!1,childList:!0,characterData:!1})};return $(document).on("change",".vtex-omnishipping-1-x-deliveryGroup #tfg-delivery-floor",(function(){"Ground"===$(this).val()?($("#tfg-lift-stairs").val(""),$("#tfg-lift-stairs").attr("disabled","disabled"),$("#tfg-lift-stairs").next("span.help.error").remove(),$(".tfg-lift-stairs").removeClass("error")):$("#tfg-lift-stairs").removeAttr("disabled")})),$(document).on("change",".vtex-omnishipping-1-x-deliveryGroup .tfg-custom-selector, .vtex-omnishipping-1-x-deliveryGroup .tfg-input",(function(){$(this).val()?($(this).parent().removeClass("error"),$(this).next("span.help.error").remove(),$(this).addClass("tfg-input-completed")):$(this).removeClass("tfg-input-completed")})),$(document).on("change",".vtex-omnishipping-1-x-addressForm input",(function(){$(this).val()&&($(this).parent().removeClass("error"),$(this).next("span.help.error").remove())})),$(document).on("change",".vtex-omnishipping-1-x-deliveryGroup #tfg-rica-same-address",(function(){$(this).is(":checked")?u("shippingAddress"):$(".rica-field").val("")})),$(document).on("click","#shipping-data .btn-link.vtex-omnishipping-1-x-btnDelivery",(()=>{h()})),$(document).ready((()=>{h()})),$(window).on("hashchange orderFormUpdated.vtex",(()=>{h()})),{state:t}})();y(),w(),k(),x()})();